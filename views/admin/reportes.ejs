<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Reportes / Quejas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <main class="wrap">
    <div class="header">
      <h2>Reportes / Quejas</h2>
      <div style="display:flex;gap:8px">
        <a class="btn" href="/admin/editar">Volver</a>
        <a class="btn" href="/admin/logout">Salir</a>
      </div>
    </div>

    <% if (toast) { %>
      <div class="alert <%= toast.type==='ok' ? '' : 'warn' %>"><%= toast.msg %></div>
    <% } %>

    <section class="card">
      <form class="grid" method="get" action="/admin/reportes">
        <label>Filtrar por placa
          <input name="placa" placeholder="Ej: ABC123" value="<%= placa || '' %>" />
        </label>
        <div><button class="btn" type="submit">Filtrar</button></div>
        <div><a class="btn" href="/admin/reportes">Limpiar</a></div>
      </form>
    </section>

    <section class="card">
      <div style="overflow:auto">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Placa</th>
              <th>Tipo</th>
              <th>Contacto</th>
              <th>Mensaje</th>
            </tr>
          </thead>
          <tbody>
            <% if (!reportes || reportes.length === 0) { %>
              <tr><td colspan="5" class="muted">No hay reportes.</td></tr>
            <% } else { %>
              <% reportes.forEach(r => { %>
                <tr>
                  <td class="muted"><%= new Date(r.createdAt).toLocaleString() %></td>
                  <td><span class="badge"><%= r.placa %></span></td>
                  <td><%= r.tipo || '-' %></td>
                  <td>
                    <div><b><%= r.nombre || '-' %></b></div>
                    <div class="muted"><%= r.telefono || '-' %></div>
                    <div class="muted"><%= r.email || '-' %></div>
                  </td>
                  <td style="white-space:pre-wrap"><%= (r.mensaje || '').replace(/</g,'&lt;').replace(/>/g,'&gt;') %></td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>
      <p class="muted" style="margin-top:10px">
        Tambi√©n disponible como JSON (con login): <a href="/api/reportes">/api/reportes</a>
      </p>
    </section>
  </main>
</body>
</html>
